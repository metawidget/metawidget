<project name="faces-addressbook-test" default="test-all">

	<property file="../../../../../build.properties" />
	<property file="../../../../build.properties" />
	<import file="${webtest.dir}/webtest.xml" />

	<target name="test-all" depends="wt.defineTasks">
		<webtest name="test-search">
			<config resultpath="../../../../../${build.dir}/run/logs">
				<option name="ThrowExceptionOnScriptError" value="false"/>			
			</config>
			<steps>
				<groovy>
				        import com.gargoylesoftware.htmlunit.NicelyResynchronizingAjaxController
						step.context.webClient.ajaxController = new NicelyResynchronizingAjaxController()
				</groovy>
				<invoke url="${webtest.url}/penguincolony-faces" />
				<verifyTitle text="Penguin Colony (Metawidget ICEfaces demo)" />
				
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/thead/tr/th[1]" text="Name"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/thead/tr/th[2]" text="Species"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[1]" text="Mumble"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[2]" text="Great penguin"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[1]" text="Tux"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[2]" text="Little penguin"/>
				<verifyXPath xpath="count(/html/body/div[@id='content']/form/table/tbody/tr)" text="2"/>
				
				<!-- Edit penguin #1 -->

				<clickLink xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[3]/a"/>				
				<verifyInputField name="form:penguinCurrentName" value="Mumble"/>
				<verifySelectField name="form:penguinCurrentSpecies" value="Great penguin"/>
				<setInputField name="form:penguinCurrentName" value="Mumbles"/>
				<setSelectField name="form:penguinCurrentSpecies" value="Banded penguin"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[1]" text="Mumbles"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[2]" text="Banded penguin"/>
				<clickButton label="Back"/>
				
				<!-- Delete penguin #2 -->

				<clickLink xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[3]/a"/>				
				<verifyInputField name="form:penguinCurrentName" value="Tux"/>
				<verifySelectField name="form:penguinCurrentSpecies" value="Little penguin"/>
				<clickButton label="Delete"/>
				<verifyXPath xpath="count(/html/body/div[@id='content']/form/table/tbody/tr)" text="1"/>

				<!-- Add penguin -->

				<clickButton label="Create New Penguin"/>
				<verifyInputField name="form:penguinCurrentName" value="New penguin"/>
				<verifySelectField name="form:penguinCurrentSpecies" value="Great penguin"/>				
				<verifyXPath xpath="count(/html/body/div[@id='content']/form/table/tbody/tr)" text="2"/>
				<setInputField name="form:penguinCurrentName" value=""/>
				<setSelectField name="form:penguinCurrentSpecies" value="Crested penguin"/>
				<verifyXPath xpath="//td[@id='table-penguinCurrentName-cell']/span[@class='inline-error']" text="Name is required"/>
				<setInputField name="form:penguinCurrentName" value="Tux 2"/>
				
				<!-- Date of Birth popup -->
				
				<not>
					<verifyXPath xpath="//td[@id='table-penguinCurrentName-cell']/span"/>
					<verifyXPath xpath="//a[@id='form:penguinCurrentDateOfBirth_c_50']"/>
				</not>
				<clickButton htmlId="form:penguinCurrentDateOfBirth_cb"/>
				<verifyXPath xpath="//a[@id='form:penguinCurrentDateOfBirth_c_50']"/>
				
				<!-- Condition popup -->
				
				<not>
					<verifyXPath xpath="//select[@name='form:penguinCurrentConditionBeak']"/>
				</not>
				<clickButton label="Add condition"/>
				<setSelectField name="form:penguinCurrentConditionBeak" value="Good"/>
				<setSelectField name="form:penguinCurrentConditionWings" value="Fair"/>
				<setSelectField name="form:penguinCurrentConditionFeet" value="Poor"/>
				
				<!-- Describe Hobbies popup -->
				
				<not>
					<verifyXPath xpath="//textarea[@name='form:penguinCurrentDescribeHobby']"/>
				</not>
				<verifyCheckbox name="form:penguinCurrentHobbies" value="Other" checked="false"/>
				<setCheckbox name="form:penguinCurrentHobbies" value="Other" checked="true"/>
				
				<!-- Begin hack until JavaScript support improves -->

				<clickButton label="Back"/>
				<clickLink xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[3]/a"/>
				
				<!-- End hack until JavaScript support improves -->
				
				<setInputField name="form:penguinCurrentDescribeHobby" value="Foo bar baz"/>				
				<clickButton label="Back"/>

				<!-- Test it all saved -->
								
				<clickLink xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[3]/a"/>
				<verifyInputField name="form:penguinCurrentName" value="Tux 2"/>
				<verifySelectField name="form:penguinCurrentConditionBeak" value="Good"/>				
				<verifySelectField name="form:penguinCurrentConditionWings" value="Fair"/>				
				<verifySelectField name="form:penguinCurrentConditionFeet" value="Poor"/>				
				<verifyCheckbox name="form:penguinCurrentHobbies" value="Other" checked="true"/>				
				<verifyTextarea name="form:penguinCurrentDescribeHobby" text="Foo bar baz"/>

			</steps>
		</webtest>
	</target>
</project>
